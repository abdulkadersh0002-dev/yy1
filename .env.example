########## SERVER CONFIGURATION ##########
PORT=4101
NODE_ENV=development

# Development convenience (opt-in)
# When enabled (and NODE_ENV is not production/test), the server will try the next port if PORT is taken.
ENABLE_PORT_FALLBACK=false
PORT_FALLBACK_ATTEMPTS=10

# Environment flags
# Local/dev defaults aim for “it boots with zero setup”.
# In production, set ALLOW_SYNTHETIC_DATA=false and REQUIRE_REALTIME_DATA=true
ALLOW_SYNTHETIC_DATA=true
REQUIRE_REALTIME_DATA=false
ENABLE_WEBSOCKETS=true
REQUEST_JSON_LIMIT=1mb

# API Keys for Real Data (production should use real secrets via SecretManager)
OPENAI_API_KEY=
TWELVE_DATA_API_KEY=
POLYGON_API_KEY=
ALPHA_VANTAGE_API_KEY=
FINNHUB_API_KEY=
NEWSAPI_KEY=
FRED_API_KEY=
EXCHANGERATE_API_KEY=
FIXER_API_KEY=

# Provider Configuration - TwelveData is primary, others as fallback
PRICE_PROVIDERS_DISABLED=
PRICE_PROVIDER_TWELVEDATA_MIN_INTERVAL_MS=1100
PRICE_PROVIDER_ALPHAVANTAGE_MIN_INTERVAL_MS=15000
PRICE_PROVIDER_POLYGON_MIN_INTERVAL_MS=1000
PRICE_PROVIDER_FINNHUB_MIN_INTERVAL_MS=1000
PRICE_PROVIDER_TWELVEDATA_MAX_PER_MINUTE=52
PRICE_PROVIDER_TWELVEDATA_COOLDOWN_MS=2000
PRICE_PROVIDER_ALPHAVANTAGE_MAX_PER_DAY=400
PRICE_PROVIDER_ALPHAVANTAGE_COOLDOWN_MS=60000
PRICE_PROVIDER_POLYGON_MAX_PER_MINUTE=80
PRICE_PROVIDER_POLYGON_COOLDOWN_MS=10000
PRICE_PROVIDER_FINNHUB_MAX_PER_MINUTE=60
PRICE_PROVIDER_FINNHUB_COOLDOWN_MS=15000
PRICE_PROVIDER_ALPHA_PREFERRED_TIMEFRAMES=H4,D1
PRICE_PROVIDER_FAST_TIMEFRAMES=M1,M5,M15,M30
PRICE_PROVIDER_SLOW_TIMEFRAMES=H4,H6,H12,D1,W1

# News Configuration - RSS feeds are always enabled, API keys optional
ENABLE_NEWS_TRANSLATION=false
NEWS_TARGET_LANGUAGE=en
NEWS_RSS_ONLY=true

AUTO_TRADING_AUTOSTART=false

# Optional presets
# - AUTO_TRADING_PRESET=smart_strong applies safe-but-strong defaults (engine + TradeManager).
# - AUTO_TRADING_PROFILE=smart_strong controls entry scoring (balanced | smart_strong | aggressive).
AUTO_TRADING_PRESET=
AUTO_TRADING_PROFILE=

# Optional: force automation to a single broker (recommended for MT5-only setups)
AUTO_TRADING_FORCE_BROKER=mt5

# Optional: override smart-strong decision threshold (0..100, lower = more entries)
AUTO_TRADING_SMART_STRONG_ENTER_SCORE=45

# Smart auto-trading guards
# If enabled, FX auto-trading will only execute inside configured London time windows.
AUTO_TRADING_ENFORCE_TRADING_WINDOWS=true
AUTO_TRADING_TRADING_WINDOWS_LONDON=[{"start":"08:00","end":"12:00"},{"start":"14:00","end":"16:00"}]

# Momentum / trend guards (only block when the indicator data exists)
AUTO_TRADING_ENFORCE_MOMENTUM_GUARDS=true
AUTO_TRADING_ENFORCE_HTF_ALIGNMENT=true

# Volatility/range sanity guards
AUTO_TRADING_ENFORCE_FX_ATR_RANGE=true
FX_ATR_PIPS_MIN=3
FX_ATR_PIPS_MAX=300

AUTO_TRADING_ENFORCE_CRYPTO_VOL_SPIKE=true
CRYPTO_ATR_PCT_SPIKE=2.2

########## TRADING / RISK CONFIGURATION ##########
# Core risk knobs are primarily configured in app/config.js via env:
RISK_BLOTTER_SIZE=25
ENABLE_RISK_COMMAND_CENTER=true
RISK_CURRENCY_LIMITS=
RISK_CORRELATION_MATRIX=
RISK_CORRELATION_ENABLED=true
RISK_CORRELATION_THRESHOLD=0.8
RISK_MAX_CORRELATED_POSITIONS=3
RISK_VAR_ENABLED=true
RISK_VAR_CONFIDENCE=0.95
RISK_VAR_LOOKBACK=50
RISK_VAR_MAX_LOSS_PCT=6
RISK_VAR_MIN_SAMPLES=20

ALERT_DRAWDOWN_THRESHOLD_PCT=
ALERT_VOLATILITY_THRESHOLD=
ALERT_VOLATILITY_COOLDOWN_MS=
ALERT_EXPOSURE_WARNING_FRACTION=

########## DATABASE (optional, required for persistence) ##########
DB_HOST=localhost
DB_PORT=5432
DB_NAME=signals_strategy
DB_USER=signals_user
DB_PASSWORD=changeme
DB_SSL=false

########## BROKER / BRIDGE CONFIGURATION ##########

# OANDA (optional, enable only when real/demo account configured)
ENABLE_BROKER_OANDA=false
OANDA_ACCOUNT_MODE=demo
OANDA_ACCESS_TOKEN=
OANDA_ACCOUNT_ID=

# MT5 Bridge
ENABLE_BROKER_MT5=true
MT5_ACCOUNT_MODE=demo
MT5_BRIDGE_URL=http://127.0.0.1:5002/api
MT5_BRIDGE_TOKEN=
MT5_ACCOUNT_NUMBER=

# IBKR
ENABLE_BROKER_IBKR=false
IBKR_ACCOUNT_MODE=demo
IBKR_GATEWAY_URL=https://127.0.0.1:5000/v1/api
IBKR_ACCOUNT_ID=
IBKR_ALLOW_SELF_SIGNED=true

BROKER_DEFAULT=mt5
BROKER_TIME_IN_FORCE=GTC

########## ALERTING / REPORTS / SERVICES ##########
ALERT_EMAIL_FROM=
ALERT_EMAIL_TO=
ALERT_SMTP_HOST=
ALERT_SMTP_PORT=587
ALERT_SMTP_SECURE=false
ALERT_SMTP_USER=
ALERT_SMTP_PASSWORD=

ALERT_SLACK_WEBHOOK=
ALERT_WEBHOOK_URLS=
ALERT_DEDUPE_MS=

ENABLE_RISK_REPORTS=true
RISK_REPORT_HOUR_UTC=7

ENABLE_PERFORMANCE_DIGESTS=true
PERFORMANCE_DIGEST_HOUR_UTC=20
PERFORMANCE_DIGEST_OUTPUT_DIR=./digests
PERFORMANCE_DIGEST_PDF_ENABLED=true

BROKER_RECONCILE_INTERVAL_MS=60000

ENABLE_PREFETCH_SCHEDULER=true
PREFETCH_TICK_MS=5000
PREFETCH_MAX_PER_TICK=10

########## PROVIDER AVAILABILITY / METRICS ##########
ALERT_PROVIDER_ENABLED=true
ALERT_PROVIDER_DEGRADED_RATIO=0.3
ALERT_PROVIDER_CRITICAL_RATIO=0.75
ALERT_PROVIDER_QUALITY_WARNING=60
ALERT_PROVIDER_QUALITY_CRITICAL=45
ALERT_PROVIDER_COOLDOWN_MS=600000
PROVIDER_AVAILABILITY_BROADCAST_INTERVAL_MS=20000
PROVIDER_AVAILABILITY_HISTORY_LIMIT=288
PROVIDER_AVAILABILITY_TIMEFRAMES=M1,M5,M15,H1,H4,D1

METRICS_PREFIX=signals
