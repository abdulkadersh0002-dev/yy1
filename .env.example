########## SERVER CONFIGURATION ##########
PORT=4101
NODE_ENV=development

# Development convenience (opt-in)
# When enabled (and NODE_ENV is not production/test), the server will try the next port if PORT is taken.
ENABLE_PORT_FALLBACK=false
PORT_FALLBACK_ATTEMPTS=10

# Environment flags (EA-only smart/strong defaults)
ALLOW_SYNTHETIC_DATA=true
REQUIRE_REALTIME_DATA=false
EA_ONLY_MODE=true
TRADING_SCOPE=execution
ENABLE_WEBSOCKETS=true
REQUEST_JSON_LIMIT=1mb
ALLOW_PUBLIC_EA_BRIDGE=false
EA_DASHBOARD_ALLOW_CANDIDATES=true
EA_DASHBOARD_QUOTE_MAX_AGE_MS=600000
EA_HEALTH_MAX_QUOTE_AGE_MS=300000

# Security / CORS
CORS_ALLOWED_ORIGINS=
CORS_ALLOW_CREDENTIALS=false

# WebSocket backpressure (drop broadcasts when client buffer too large)
WS_MAX_BUFFERED_BYTES=1000000

# Background job queue (ETL/backtests/long tasks)
ENABLE_JOB_QUEUE=true
JOB_QUEUE_CONCURRENCY=2
JOB_QUEUE_RETRY_ATTEMPTS=2
JOB_QUEUE_RETRY_BASE_MS=500
JOB_QUEUE_RETRY_MAX_MS=10000
JOB_QUEUE_MAX_SIZE=5000
JOB_QUEUE_DEAD_LETTER_MAX=200
# Price bar data-quality controls
PRICE_BARS_MAX_FUTURE_MS=120000
PRICE_BARS_MAX_AGE_MULTIPLIER=2.6
PRICE_BARS_GAP_MULTIPLIER=1.8
PRICE_BARS_MAX_GAP_RATIO=0.35
PRICE_BARS_ENFORCE_QUALITY=false

# Data-quality circuit breaker auto re-enable
DATA_QUALITY_AUTO_REENABLE=true
DATA_QUALITY_REENABLE_MIN_SCORE=78
DATA_QUALITY_REENABLE_MIN_HEALTHY=2
DATA_QUALITY_REENABLE_WINDOW_MS=240000

# News Configuration (RSS only)
ENABLE_NEWS_TRANSLATION=false
NEWS_TARGET_LANGUAGE=en
NEWS_RSS_ONLY=true
EA_RSS_CALENDAR_ENABLED=true
EA_RSS_CALENDAR_DAYS_AHEAD=3
EA_SIGNAL_NEWS_LOOKBACK_MINUTES=120
EA_SIGNAL_NEWS_LOOKAHEAD_MINUTES=90
EA_SIGNAL_NEWS_IMPACT_THRESHOLD=70
EA_SIGNAL_NEWS_IMMINENT_MINUTES=20
EA_SIGNAL_NEWS_MAX_ITEMS=120
EA_SIGNAL_NEWS_CONFIDENCE_PENALTY=12
EA_SIGNAL_NEWS_STRENGTH_PENALTY=8
EA_SIGNAL_NEWS_MAX_PENALTY=45

AUTO_TRADING_AUTOSTART=true

# Optional presets
# - AUTO_TRADING_PRESET=smart_strong applies safe-but-strong defaults (engine + TradeManager).
# - AUTO_TRADING_PROFILE=smart_strong controls entry scoring (balanced | smart_strong | aggressive).
AUTO_TRADING_PRESET=smart_strong
AUTO_TRADING_PROFILE=smart_strong

# Optional: force automation to a single broker (recommended for MT5-only setups)
AUTO_TRADING_FORCE_BROKER=mt5

# Smart-strong mode (stricter execution + smarter gating)
EA_SMART_STRONG=true
AUTO_TRADING_SMART_STRONG=true
AUTO_TRADING_SMART_MIN_CONFIDENCE=55
AUTO_TRADING_SMART_MIN_STRENGTH=45
AUTO_TRADING_SMART_MIN_SCORE=50
EA_SMART_MAX_SPREAD_PCT=0.12
EA_SMART_MAX_SPREAD_POINTS=45
EA_SMART_REQUIRE_QUOTE=true
EA_SMART_MAX_BAR_AGE_MS=1200000
EA_SMART_REQUIRE_BARS_COVERAGE=true
EA_SMART_BARS_MIN_M15=60
EA_SMART_BARS_MIN_H1=20
EA_SMART_BARS_MAX_AGE_M15_MS=1800000
EA_SMART_BARS_MAX_AGE_H1_MS=10800000

# Smart exit (close open trades on strong opposite signal)
AUTO_TRADING_SMART_EXIT_REVERSE=true
AUTO_TRADING_SMART_EXIT_MIN_CONFIDENCE=60
AUTO_TRADING_SMART_EXIT_MIN_STRENGTH=50
AUTO_TRADING_SMART_EXIT_MIN_SCORE=60
AUTO_TRADING_SMART_EXIT_RECHECK_MS=30000

# Optional: override smart-strong decision threshold (0..100, lower = more entries)
AUTO_TRADING_SMART_STRONG_ENTER_SCORE=45

# Smart auto-trading guards
# FX auto-trading executes inside configured London time windows.
AUTO_TRADING_ENFORCE_TRADING_WINDOWS=true
AUTO_TRADING_TRADING_WINDOWS_LONDON=[{"start":"08:00","end":"12:00"},{"start":"14:00","end":"16:00"}]

# Momentum / trend guards (only block when the indicator data exists)
AUTO_TRADING_ENFORCE_MOMENTUM_GUARDS=true
AUTO_TRADING_ENFORCE_HTF_ALIGNMENT=true

# News blackout (pre/post high-impact events)
AUTO_TRADING_NEWS_BLACKOUT_MINUTES=45
AUTO_TRADING_NEWS_BLACKOUT_IMPACT=60

# Execution-cost hard gates (spread vs ATR/TP)
AUTO_TRADING_ENFORCE_SPREAD_TO_ATR=true
AUTO_TRADING_MAX_SPREAD_TO_ATR=0.18
AUTO_TRADING_MAX_SPREAD_TO_TP=0.25

# Multi-timeframe bar coverage + HTF alignment gates
AUTO_TRADING_REQUIRE_BARS_COVERAGE=true
AUTO_TRADING_BARS_MIN_M15=60
AUTO_TRADING_BARS_MIN_H1=20
AUTO_TRADING_BARS_MAX_AGE_M15_MS=1800000
AUTO_TRADING_BARS_MAX_AGE_H1_MS=10800000
AUTO_TRADING_REQUIRE_HTF_DIRECTION=true

# Volatility/range sanity guards
AUTO_TRADING_ENFORCE_FX_ATR_RANGE=true
FX_ATR_PIPS_MIN=3
FX_ATR_PIPS_MAX=300

AUTO_TRADING_ENFORCE_CRYPTO_VOL_SPIKE=true
CRYPTO_ATR_PCT_SPIKE=2.2

# EA ingest freshness guards
EA_MAX_QUOTE_AGE_MS=120000
EA_MAX_QUOTE_FUTURE_MS=120000
EA_MAX_NEWS_AGE_MS=1209600000
EA_MAX_NEWS_FUTURE_MS=31536000000
EA_MAX_BAR_FUTURE_MS=300000

########## TRADING / RISK CONFIGURATION ##########
# Core risk knobs are primarily configured in app/config.js via env:
RISK_BLOTTER_SIZE=25
ENABLE_RISK_COMMAND_CENTER=true
RISK_CURRENCY_LIMITS=
RISK_CORRELATION_MATRIX=
RISK_CORRELATION_ENABLED=true
RISK_CORRELATION_THRESHOLD=0.8
RISK_MAX_CORRELATED_POSITIONS=3
RISK_VAR_ENABLED=true
RISK_VAR_CONFIDENCE=0.95
RISK_VAR_LOOKBACK=50
RISK_VAR_MAX_LOSS_PCT=6
RISK_VAR_MIN_SAMPLES=20

ALERT_DRAWDOWN_THRESHOLD_PCT=
ALERT_VOLATILITY_THRESHOLD=
ALERT_VOLATILITY_COOLDOWN_MS=
ALERT_EXPOSURE_WARNING_FRACTION=

########## DATABASE (optional, required for persistence) ##########
DB_HOST=localhost
DB_PORT=5432
DB_NAME=signals_strategy
DB_USER=signals_user
DB_PASSWORD=changeme
DB_SSL=false

# Persistence retry/backoff (avoid permanent disable on transient DB errors)
PERSISTENCE_RETRY_BASE_MS=5000
PERSISTENCE_RETRY_MAX_MS=60000
PERSISTENCE_MAX_FAILURES=10
PERSISTENCE_DISABLE_PERMANENT=false

########## BROKER / BRIDGE CONFIGURATION ##########

# OANDA (optional, enable only when real/demo account configured)
ENABLE_BROKER_OANDA=false
OANDA_ACCOUNT_MODE=demo
OANDA_ACCESS_TOKEN=
OANDA_ACCOUNT_ID=

# MT5 Bridge
ENABLE_BROKER_MT5=true
MT5_ACCOUNT_MODE=demo
MT5_BRIDGE_URL=http://127.0.0.1:5002/api
MT5_BRIDGE_TOKEN=
MT5_ACCOUNT_NUMBER=

# IBKR
ENABLE_BROKER_IBKR=false
IBKR_ACCOUNT_MODE=demo
IBKR_GATEWAY_URL=https://127.0.0.1:5000/v1/api
IBKR_ACCOUNT_ID=
IBKR_ALLOW_SELF_SIGNED=true

BROKER_DEFAULT=mt5
BROKER_TIME_IN_FORCE=GTC
BROKER_IDEMPOTENCY_TTL_MS=600000
BROKER_RETRY_ATTEMPTS=1
BROKER_RETRY_BASE_MS=400
BROKER_BREAKER_THRESHOLD=3
BROKER_BREAKER_COOLDOWN_MS=60000
BROKER_SERVER_TIMEZONE=UTC
BROKER_SYMBOL_SUFFIX=
BROKER_SYMBOL_ALLOWLIST=
BROKER_SYMBOL_MAP=
BROKER_METALS_SYMBOLS=XAUUSD,XAGUSD

# Market rules (UTC-only)
MARKET_FOREX_OPEN_UTC=21:00
MARKET_FOREX_CLOSE_UTC=21:00
MARKET_ROLLOVER_START_UTC=21:55
MARKET_ROLLOVER_END_UTC=22:10
MARKET_BLOCK_ROLLOVER=true
MARKET_BLOCK_CLOSED=true

# Risk caps
MAX_RISK_PER_SYMBOL=0.04

########## GOVERNANCE / TARGETS ##########
# Execution scope is required for auto-trading.
TRADING_SCOPE=execution
TARGET_UPTIME_PCT=99.9
TARGET_P95_LATENCY_MS=250
TARGET_MAX_ERROR_RATE_PCT=0.5
TARGET_MAX_DRAWDOWN_PCT=8
TARGET_MAX_SLIPPAGE_PIPS=0.8

########## ALERTING / REPORTS / SERVICES ##########
ALERT_EMAIL_FROM=
ALERT_EMAIL_TO=
ALERT_SMTP_HOST=
ALERT_SMTP_PORT=587
ALERT_SMTP_SECURE=false
ALERT_SMTP_USER=
ALERT_SMTP_PASSWORD=

ALERT_SLACK_WEBHOOK=
ALERT_WEBHOOK_URLS=
ALERT_DEDUPE_MS=

ENABLE_RISK_REPORTS=true
RISK_REPORT_HOUR_UTC=7

ENABLE_PERFORMANCE_DIGESTS=true
PERFORMANCE_DIGEST_HOUR_UTC=20
PERFORMANCE_DIGEST_OUTPUT_DIR=./digests
PERFORMANCE_DIGEST_PDF_ENABLED=true

BROKER_RECONCILE_INTERVAL_MS=60000

ENABLE_PREFETCH_SCHEDULER=true
PREFETCH_TICK_MS=5000
PREFETCH_MAX_PER_TICK=10

########## PROVIDER AVAILABILITY / METRICS ##########
ALERT_PROVIDER_ENABLED=true
ALERT_PROVIDER_DEGRADED_RATIO=0.3
ALERT_PROVIDER_CRITICAL_RATIO=0.75
ALERT_PROVIDER_QUALITY_WARNING=60
ALERT_PROVIDER_QUALITY_CRITICAL=45
ALERT_PROVIDER_COOLDOWN_MS=600000
PROVIDER_AVAILABILITY_BROADCAST_INTERVAL_MS=20000
PROVIDER_AVAILABILITY_HISTORY_LIMIT=288
PROVIDER_AVAILABILITY_TIMEFRAMES=M1,M5,M15,H1,H4,D1

METRICS_PREFIX=signals

########## OPTIONAL LIVE PROVIDERS (unused in EA-only mode) ##########
## Intentionally removed: external provider tuning/env vars.
## EA-only + RSS-only mode does not require API keys.
