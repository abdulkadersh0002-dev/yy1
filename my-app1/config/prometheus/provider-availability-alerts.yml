groups:
  - name: provider-availability.slo
    interval: 30s
    rules:
      - alert: ProviderAvailabilityCritical
        expr: signals_provider_availability_recent_incidents{severity="critical",window="1h"} > 0
        for: 5m
        labels:
          severity: critical
          service: signals-app
        annotations:
          summary: "Provider health incident (critical)"
          description: |
            Provider availability entered a critical state in the last hour.
            Investigate upstream provider outages or credential failures.
          runbook: "https://docs.signalsstrategy.dev/runbooks/operational-provider-outage"
          ticket_hint: "Auto-ticket generated via alertmanager webhook"
      - alert: ProviderAvailabilityDegraded
        expr: signals_provider_availability_recent_incidents{severity="degraded",window="1h"} > 2
        for: 10m
        labels:
          severity: warning
          service: signals-app
        annotations:
          summary: "Provider availability degraded"
          description: |
            Provider availability experienced multiple degraded incidents within the last hour.
            Review dashboard trend card and /api/health/providers for details.
          runbook: "https://docs.signalsstrategy.dev/runbooks/operational-provider-outage"
      - alert: ProviderAvailabilityUptimeSLOBreached
        expr: signals_provider_availability_uptime_ratio{window="history"} < 0.985
        for: 30m
        labels:
          severity: warning
          service: signals-app
        annotations:
          summary: "Provider uptime ratio below SLO"
          description: |
            Provider availability uptime ratio fell below the 98.5% target across the retained history window.
            Review provider trend dashboard and recent incidents to restore stability.
          runbook: "https://docs.signalsstrategy.dev/runbooks/operational-provider-outage"
      - record: provider_availability:samples_total
        expr: sum by (state) (signals_provider_availability_samples_total)
      - record: provider_availability:operational_ratio
        expr: clamp_max(provider_availability:samples_total{state="operational"} / ignoring(state) sum(provider_availability:samples_total), 1)
