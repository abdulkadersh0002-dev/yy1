global:
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 2h
  receiver: signals-default
  routes:
    - matchers:
        - severity="critical"
      receiver: signals-critical
    - matchers:
        - severity="warning"
      receiver: signals-warning

receivers:
  - name: signals-default
    slack_configs:
      - api_url: '${ALERTMANAGER_SLACK_WEBHOOK}'
        channel: '#signals-ops'
        title: '[signals] {{ .CommonLabels.alertname }} â€” {{ .CommonLabels.severity | toUpper }}'
        text: |
          *Service*: {{ .CommonLabels.service }}
          *Summary*: {{ .CommonAnnotations.summary }}
          *Description*: {{ .CommonAnnotations.description }}
          *Runbook*: {{ .CommonAnnotations.runbook }}
        send_resolved: true
  - name: signals-warning
    slack_configs:
      - api_url: '${ALERTMANAGER_SLACK_WEBHOOK}'
        channel: '#signals-ops'
        title: '[signals][warning] {{ .CommonLabels.alertname }}'
        text: |
          {{ template "provider.alert.body" . }}
        send_resolved: true
  - name: signals-critical
    slack_configs:
      - api_url: '${ALERTMANAGER_SLACK_WEBHOOK_CRITICAL}'
        channel: '#signals-incident'
        title: '[signals][critical] {{ .CommonLabels.alertname }}'
        text: |
          {{ template "provider.alert.body" . }}
        send_resolved: true
    webhook_configs:
      - url: '${ALERTMANAGER_TICKETING_WEBHOOK}'
        send_resolved: true

templates:
  - 'config/alertmanager/templates/provider-alert.tmpl'
